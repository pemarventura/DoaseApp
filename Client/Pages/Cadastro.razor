
@page "/cadastro"
@using DoaseApp.Shared;
@using DoaseApp.Shared.Enums;
@using System.ComponentModel;
@inject HttpClient httpClient
@inject IPersonRepository PersonRepository

<h1 style="text-align:center;">Cadastro de Usuário</h1>

@if (!showForm1 && !showForm2 && !isSubmitted)
{
    <div class="d-flex justify-content-center">
        <div class="card bg-light p-5" >
            <div class="card-body">
                <div class="d-flex justify-content-center">
                    <form class="form-inline">
                        <div class="d-flex flex-column">
                        <div class="form-check form-check-inline mr-4">
                            <input class="form-check-input" type="radio" name="option" id="option1" value="1" @onclick="() => selectedOption = '1'">
                            <label class="form-check-label" for="option1">Pessoa Jurídica</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="option" id="option2" value="2" @onclick="() => selectedOption = '2'">
                            <label class="form-check-label" for="option2">Pessoa Física</label>
                        </div>
                        <div class="mt-4 text-center">
                            <button type="submit" class="btn btn-info btn-lg w-100 text-light" @onclick="@ShowForm" style="margin-top: 10px;">Submit</button>
                        </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
}

@if (showForm1)
{
    <EditForm Model="@person" OnSubmit="@SubmitForm">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="name">Empresa:</label>
                    <InputText id="name" class="form-control" @bind-Value="@person.NomeEmpresa" required />
                    <ValidationMessage For="@(() => person.FirstName)" />
                </div>

                <div class="form-group">
                    <label for="cpf">CNPJ:</label>
                    <InputText id="cpf" class="form-control" @bind-Value="@person.CNPJ" required />
                    <ValidationMessage For="@(() => person.CPF)" />
                </div>

                <div class="form-group">
                    <label for="phone-number">Telefone:</label>
                    <InputText id="phone-number" class="form-control" @bind-Value="@person.PhoneNumber" required />
                    <ValidationMessage For="@(() => person.PhoneNumber)" />
                </div>

                <div class="form-group">
                    <label for="area">Área de Empreendimento:</label>
                    <InputSelect id="area" class="form-control" @bind-Value="@person.AreaEmpreendimento" required>
                        @foreach (AreasEmpreendimento area in Enum.GetValues(typeof(AreasEmpreendimento)))
                        {
                            string description = GetEnumDescription(area);
                            <option value="@area">@description</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="@(() => person.AreaEmpreendimento)" />
                </div>
            </div>

            <div class="col-md-4">

                <div class="form-group">
                    <label for="address">Cidade:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.City" required />
                    <ValidationMessage For="@(() => person.City)" />
                </div>

                <div class="form-group">
                    <label for="address">Bairro:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.Neighborhood" required />
                    <ValidationMessage For="@(() => person.Neighborhood)" />
                </div>

                <div class="form-group">
                    <label for="address">Endereço:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.Address" required />
                    <ValidationMessage For="@(() => person.Address)" />
                </div>

                <div class="form-group">
                    <label for="address">CEP:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.CEP" required />
                    <ValidationMessage For="@(() => person.CEP)" />
                </div>

            </div>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Salvar</button>
        </div>
    </EditForm>
}

@if (showForm2)
{
    <EditForm Model="@person" OnSubmit="@SubmitForm">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="name">Nome:</label>
                    <InputText id="name" class="form-control" @bind-Value="@person.FirstName" required />
                    <ValidationMessage For="@(() => person.FirstName)" />
                </div>

                <div class="form-group">
                    <label for="last-name">Sobrenome:</label>
                    <InputText id="last-name" class="form-control" @bind-Value="@person.LastName" required />
                    <ValidationMessage For="@(() => person.LastName)" />
                </div>

                <div class="form-group">
                <label for="cpf">CPF:</label>
                <InputText id="cpf" class="form-control" @bind-Value="@person.CPF" required pattern="[0-9]{3}\.[0-9]{3}\.[0-9]{3}-[0-9]{2}" />
                <ValidationMessage For="@(() => person.CPF)" />
            </div>

                <div class="form-group">
                    <label for="date-of-birth">Data de nascimento:</label>
                    <InputDate id="date-of-birth" class="form-control" @bind-Value="@person.DateOfBirth" required />
                    <ValidationMessage For="@(() => person.DateOfBirth)" />
                </div>

                <div class="form-group">
                    <label for="phone-number">Telefone:</label>
                    <InputText id="phone-number" class="form-control" @bind-Value="@person.PhoneNumber" required />
                    <ValidationMessage For="@(() => person.PhoneNumber)" />
                </div>
            </div>

            <div class="col-md-4">

                <div class="form-group">
                    <label for="state">Estado:</label>
                    <InputSelect id="state" class="form-control" @bind-Value="@person.State" required>
                        @foreach (var state in Enum.GetValues(typeof(BrazilianState)))
                        {
                            <option value="@state">@state</option>
                        }
                    </InputSelect>
                    <ValidationMessage For="@(() => person.State)" />
                </div>

                <div class="form-group">
                    <label for="address">Cidade:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.City" required />
                    <ValidationMessage For="@(() => person.City)" />
                </div>

                <div class="form-group">
                    <label for="address">Bairro:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.Neighborhood" required />
                    <ValidationMessage For="@(() => person.Neighborhood)" />
                </div>

                <div class="form-group">
                    <label for="address">Endereço:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.Address" required />
                    <ValidationMessage For="@(() => person.Address)" />
                </div>

                <div class="form-group">
                    <label for="address">CEP:</label>
                    <InputText id="address" class="form-control" @bind-Value="@person.CEP" required />
                    <ValidationMessage For="@(() => person.CEP)" />
                </div>

            </div>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Salvar</button>
        </div>
    </EditForm>
}

@if (isSubmitted && showForm3 == false)
{
    <div class="d-flex justify-content-center">
        <div class="card bg-light p-5">
            <div class="card-body d-flex flex-column align-items-center">
                <p>Seus dados foram salvos com sucesso!</p>
                <div class="d-flex justify-content-center">
                    <button type="button" class="btn btn-primary mr-2" @onclick="@ResetForm">Voltar</button>
                    <button type="button" class="btn btn-primary" @onclick="@ShowForm2">Continuar</button>
                </div>
            </div>
        </div>
    </div>
}

@*@if (showForm3)
{
    <div class="d-flex justify-content-center mt-4">
        <div class="card bg-light p-5">
            <div class="card-body">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input id="email" class="form-control" @bind="@person.Email">
                </div>
                <div class="form-group">
                    <label for="senha">Senha:</label>
                    <input id="senha" class="form-control" type="password" @bind="@person.Senha">
                </div>
                <button type="button" class="btn btn-primary" @onclick="@SubmitForm2">Finalizar</button>
            </div>
        </div>
    </div>
}*@

@if (names != null && names.Any())
{
    <h2>Nomes Cadastrados:</h2>
    <ul>
        @foreach (var name in names)
        {
            <li>@name</li>
        }
    </ul>
}

@*<button type="button" class="btn btn-secondary" @onclick="@GetNames" style="margin-top: 10px;">Mostrar Nomes</button>*@

@code {
    private Person person = new Person();
    public bool isSubmitted = false;
    public bool isSaved = false;
    private List<string> names;

    char selectedOption = ' '; // Variable to store the selected option
    bool showForm1 = false; // Flag to show/hide form 1
    bool showForm2 = false; // Flag to show/hide form 2
    bool showForm3 = false; // Flag to show/hide form 3

    private async Task SaveUserData()
    {
        await httpClient.PostAsJsonAsync("api/person", person);
        isSaved = true;
        showForm1 = false;
        showForm2 = false;
    }

    private async Task GetNames()
    {
        names = await httpClient.GetFromJsonAsync<List<string>>("api/person");
    }

    private void ShowForm()
    {
        if (selectedOption == '1')
        {
            showForm1 = true;
            showForm2 = false;
        }
        else if (selectedOption == '2')
        {
            showForm1 = false;
            showForm2 = true;
        }
    }

    private void ShowForm2()
    {
        showForm3 = true;
    }

    private void ResetForm()
    {
        isSaved = false;
    }

    static string GetEnumDescription(Enum value)
    {
        var fieldInfo = value.GetType().GetField(value.ToString());
        var attributes = (DescriptionAttribute[])fieldInfo.GetCustomAttributes(typeof(DescriptionAttribute), false);

        return attributes.Length > 0 ? attributes[0].Description : value.ToString();
    }

    private async Task SubmitForm()
    {
        // Add any desired logic here to process the form data
        // ...

        showForm1 = false;
        showForm2 = false;
        isSubmitted = true;
    }
    
}